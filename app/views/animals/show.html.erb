<%= title "#{@animal.name} (#{@animal.id})" %>

<%= content_for :javascripts do %>
	<%= javascript_include_tag "animals/animals", "alerts/alerts", "notes/notes", "tasks/tasks", "date", :cache => "cache/application/animals-show" %>
	<script type="text/javascript">
		$(function() {
			Notes.filters();
			Tasks.initialize();
		});
	</script>
<% end %>

<%= content_for :page_content do %>
	<div class="page_heading blue_background">
		<table class="animal">
			<tr>
				<td>
					<h1><%= @animal.name %><span>#<%= @animal.id %></span></h1>
				</td>
				<td class="action_links">
					<%= link_to "Create new animal", new_animal_path %>
					<% if can?(:update, Animal) %>
					&nbsp;&nbsp;|&nbsp;&nbsp;
					<%= link_to "Edit", edit_animal_path(@animal)%>
					<% end %>
					<% if can?(:destroy, Animal) %>
					&nbsp;&nbsp;|&nbsp;&nbsp;
					<%= link_to "Delete", @animal, :confirm => "Are you sure?", :method => :delete %>
					<% end %>
				</td>
			</tr>
			<tr>
				<td>
					<p><%= @animal.animal_type.name %>:  <%= full_breed(@animal) %></p>
				</td>
				<td class="status">
					<p><%= @animal.animal_status.name %></p>
				</td>
			</tr>
		</table>
	</div>
	
	<div class="page_content">
		 
		<table class="animal_details">
			<tr>
				<td class="metadata">
					<h3>Details:</h3>
					<ul>
						<li><p><b>Weight:</b> <%= @animal.weight %></p></li>
						<li><p><b>Age (Est.):</b> <%= humanize_dob(@animal.date_of_birth) %></p></li>
						<li><p><b>MicroChip:</b> <%= @animal.microchip %></p></li>
						<li><p><b>Color:</b> <%= @animal.color %></p></li>
						<li><p><b>Sex:</b> <%= @animal.sex.humanize unless @animal.sex.blank? %> <% if @animal.is_sterilized %>(Sterilized)<% end %></p></li>
					</ul>
					
					<h3>Accommodation:</h3>
					<ul>
						<li><p><b>Name:</b> <%= @animal.accommodation.name unless @animal.accommodation.blank? %></p></li>
						<li><p><b>Location:</b> <%= @animal.accommodation.location.name if @animal.accommodation && @animal.accommodation.location %></p></li>
					</ul>
					
					
				</td>
				<td class="image">
			    	<%= image_tag @animal.photo.url(:medium) %>
			    </td>
			</tr>
		</table>
		
		<table class="description">
			<tr>
				<td>
					<h3>Description:</h3>
					<p><%= @animal.description %></p>
				</td>
			</tr>
		</table>
		
		<% if @current_shelter.is_kill_shelter %>
		<table class="euthanasia_info">
			<tr>
				<td>
					<h3>Euthanasia Info:</h3>
					<ul>
						<li><p><b>Arrival Date:</b> <span class="date"><%= format_date(:default, @animal.arrival_date) %></span></p></li>
						<li><p><b>Hold time:</b> <span class="date"><%= @animal.hold_time %> days</span></p></li>
						<li><p><b>Euthanasia Date:</b> <span class="red_date"><%= format_date(:default, @animal.euthanasia_scheduled) %></span></p></li>
					</ul>
				</td>
			</tr>
		</table>
		<% end %>

		
	</div>
	
	<div class="notes_heading yellow_background">
		<h2>Notes</h2>
		<div class="links">
			<%= link_to 'All', filter_notes_animals_path(:id => @animal.id), :remote => true, :id => "all_notes_link" %>
			<% NoteCategory.all.each do |category|%>
				&nbsp;|&nbsp;
				<%= link_to category.name, filter_notes_animals_path(:filter => category.name, :id => @animal.id), 
				                          :remote => true, :id => "#{category.name.downcase}_notes_link" %>
			<% end %>
		</div>
	</div>
	
	<div class="page_content">
		<div id="notes" class="note_list">
			<%= render @notes %>
		</div>
	</div>
	
	<div class="status_history_heading yellow_background">
		<h2>Status history</h2>
	</div>
	
	<div class="page_content">
		<div id="status_histories" class="status_history_list">
			<%= render @status_histories %>
		</div>
	</div>

<% end %>

<%= content_for :sidebar do %>

	<ul class="model_actions">
		<li><%= link_to 'Add Alert', "#", :id => "add_alert_link", :class => "button" %></li>
		<li><%= link_to 'Add Note', "#", :id => "add_note_link", :class => "button" %></li>
		<li><%= link_to 'Add Task', "#", :id => "add_task_link", :class => "button" %></li>
	</ul>
	
	<div id="create_alert">
		<h2>Add an alert for <%= @animal.name %></h2>
		<div id="alert_errors"></div>
		<%= form_for ([@animal, Alert.new]), :remote => true do |f| %>
			<ul>
				<%= render "alerts/form", :f => f %>
		    	<li class="buttons">
					<%= f.submit "Create Alert", :disable_with => "Submitting...", :id => "create_alert_button", :class => "button"  %>
					&nbsp;or&nbsp;
					<%= link_to "Cancel", "#", :id => "cancel_alert" %>
				</li>
			</ul>
		<% end %>
	</div>
	
	<div id="create_note">
		<h2>Add a note for <%= @animal.name %></h2>
		<div id="note_errors"></div>
		<%= form_for ([@animal, Note.new]), :remote => true do |f| %>
			<ul>
				<%= render "notes/form", :f => f %>
		    	<li class="buttons">
					<%= f.submit "Create Note", :disable_with => "Submitting...", :id => "create_note_button", :class => "button"  %>
					&nbsp;or&nbsp;
					<%= link_to "Cancel", "#", :id => "cancel_note" %>
				</li>
			</ul>
		<% end %>
		<div id="another_note_category"></div>
	</div>
	
	<div id="create_task">
		<h2>Add a task for <%= @animal.name %></h2>
		<div id="task_errors"></div>
		<%= form_for ([@animal, Task.new]), :remote => true do |f| %>
			<ul>
				<%= render "tasks/form", :f => f %>
		    	<li class="buttons">
					<%= f.submit "Create Task", :disable_with => "Submitting...", :id => "create_task_button", :class => "button"  %>
					&nbsp;or&nbsp;<%= link_to "Cancel", "#", :id => "cancel_task" %>
				</li>
			</ul>
		<% end %>
	</div>
	
	<div id="animal_alerts">
		<h2>Alerts</h2>
		<div id="alerts" class="alert_list">
			<%= render :partial => 'alerts/alert', :collection => @alerts %>
		</div>
	</div>

	<div id="animal_tasks">
		<h2>Tasks</h2>
		<%= render :partial => 'tasks/task_list', :locals => { :animal_link => false } %>
	</div>

<% end %>
	
