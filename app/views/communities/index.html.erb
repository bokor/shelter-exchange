<%= title "Community" %>

<%= content_for :javascripts do %>
	
	<%# javascript_include_tag "", :cache => "cache/application/communities-index" %>
	<%= javascript_include_tag "http://maps.google.com/maps/api/js?sensor=false", "shelters/shelters", :cache => "cache/application/communities-index" %>
	<script type="text/javascript">
		$(function() {
			$("#form_search").find(":radio").bind("change", function(){
				$("#form_search").find(":text").val("");
				$("#form_search").find(":text").attr("disabled","disabled");
				$(this).siblings(":text").attr("disabled","");
			});
			
			
		
			var geocoder = new google.maps.Geocoder();
			var myLatlng = new google.maps.LatLng(<%=@current_shelter.lat%>,<%=@current_shelter.lng%>);
			var myOptions = {
		      zoom: 8,
		      center: myLatlng,
		      mapTypeId: google.maps.MapTypeId.ROADMAP
		    }
		    var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
			$("#map_search").bind("click", function(e){
				geocoder.geocode( { 'address': $("#address").val() }, function(results, status) {
			     	if (status == google.maps.GeocoderStatus.OK) {
			        	map.setCenter(results[0].geometry.location);
			        	var marker = new google.maps.Marker({
			            	map: map, 
			            	position: results[0].geometry.location
			        	});
			      	} else {
			        	alert("Geocode was not successful for the following reason: " + status);
			      	}
			    });
				
			});
			
			var fileUrl = 'http://www.designwaves.com/shelters.kml?<%=Time.new.to_i%>';
			var kmlLayer = new google.maps.KmlLayer(fileUrl, { preserveViewport: true });
			kmlLayer.setMap(map);

			  
			
		});
	</script>
<% end %>

<%= content_for :page_content do %>

	<div class="page_heading green_background">
		<h1>Community</h1>
	</div>
		
	<div class="page_content clearfix">
		
		<div style="float:left; width: 25%" class="search_filters">
			<h2>Search by:</h2>
			<%# form_for :communities, :url => { :action => :search }, :html => { :id => "form_search", :method => :get } do |f| %>
				<ul class="form">
					<li>
						<%= radio_button_tag :search_by, :address, (params[:search_by] == "address") %> 
						<%= label_tag :address, "Address Info" %><br />
						<%= text_field_tag :address, @address_search  %> 
						<%# text_field_tag :address, @address_search, :disabled => params[:address].blank?  %> 
					</li>
					<!-- <li>
											<%= radio_button_tag :search_by, :shelter, (params[:search_by] == "shelter") %> 
											<%= label_tag :shelter, "Shelter name" %><br />
											<%= text_field_tag :shelter, @shelter_search, :disabled => @shelter.blank?, :autocomplete => :off %>
										</li> -->
					<li><%= submit_tag "Go", :disable_with => "...", :id => "map_search"  %></li>
				</ul>
				
			<h2>Filter by:</h2>
			
			<%# end %>
		</div>
		
		<div style="float:left; width: 75%" class="results">

		
		<script type="text/javascript">
			$(function() {
				
				// var map;
				// 			var geocoder;
				// 			var latlng;
				// 			
				// 			if(navigator.geolocation) {
				// 				navigator.geolocation.getCurrentPosition(geolocationSuccess, geolocationFailure);
				// 			}
				// 			
				// 			function geolocationSuccess(position){
				// 				latlng = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
				// 				map.setCenter(latlng);
				// 			}
				// 			
				// 			function geolocationFailure(position){
				// 				geocoder = new google.maps.Geocoder();
				// 				
				// 			}
				

				
				// Try W3C Geolocation (Preferred) -> Public Only
				// if(navigator.geolocation) {
				// 	navigator.geolocation.getCurrentPosition(success, failure);
				// }
				
				// var myLatlng = new google.maps.LatLng(<%=@bounds.center.lat%>,<%=@bounds.center.lng%>);
				// var myOptions = {
				// 	zoom: 10,
				//    	center: myLatlng,
				// 	mapTypeId: google.maps.MapTypeId.ROADMAP
				// }
				// 
				// var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
				// 	
				// var fileUrl = 'http://www.designwaves.com/shelters.kml?<%=Time.new.to_i%>';
				// var kmlLayer = new google.maps.KmlLayer(fileUrl, { preserveViewport: true });
				// kmlLayer.setMap(map);
				
				
				
				// google.maps.event.addListener(map, 'bounds_changed', function() {
				//          alert(map.getBounds());
				//       });
				
				// google.maps.event.addListenerOnce(map, 'idle', function(){
				//         alert(this.getBounds());
				//     });
				
				// google.maps.event.addListener(map, 'zoom_changed', function() {
				// 				    alert(this.getBounds();
				// 				  });
				
				// google.maps.event.addListener(map, 'zoom_changed', function() {
				//     zoomLevel = map.getZoom();
				//     infowindow.setContent("Zoom: " + zoomLevel);
				//     if (zoomLevel == 0) {
				//       map.setZoom(10);
				//     }      
				//   });

				
			});
		</script>
		
		<div id="map_canvas" style="width:100%; height: 450px;"></div>
		<br /><br />
		<div style="float:left; width:45%">
			<h2>Animals</h2>
		</div>
		<div style="float:left; width:45%padding-left: 5%;">
			<h2>Urgent Needs</h2>
		</div>
		
		</div>
		
	</div>
		
<% end %>

<%= content_for :sidebar do %>
<% end %>