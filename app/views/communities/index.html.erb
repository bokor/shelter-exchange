<%= title "Community" %>

<%= content_for :javascripts do %>
	
	<%# javascript_include_tag "", :cache => "cache/application/communities-index" %>
	<%= javascript_include_tag "http://maps.google.com/maps/api/js?sensor=false", :cache => "cache/application/communities-index" %>
	<!--<script src="http://maps.google.com/maps?file=api&amp;v=3&amp;sensor=true&amp;key=ABQIAAAAg9xsqgYJxaHo-DnBFgP6xhQZBR8TEZ45tFz_789J8-GbLsU4URRDIGKVV4lSFKfojQ_xqRLlgkZGhg" type="text/javascript"></script>-->
<% end %>

<%= content_for :page_content do %>

	<div class="page_heading green_background">
		<h1>Community</h1>
	</div>
		
	<div class="page_content">
		<% @shelters.each do |shelter| %>
			<p><%= shelter.name %></p>
		<% end %>
		
		<script type="text/javascript">
			$(function() {
				var myLatlng = new google.maps.LatLng(<%=@current_shelter.lat%>,<%=@current_shelter.lng%>);
			    var myOptions = {
			      zoom: 10,
			      center: myLatlng,
				  navigationControl: true,
				  mapTypeControl: false,
				  streetViewControl:  false,
			      mapTypeId: google.maps.MapTypeId.ROADMAP
			    }

			    var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
<% @shelters.each do |shelter| %>
				
				var shelterLatLng_<%=shelter.id%> = new google.maps.LatLng(<%=shelter.lat%>,<%=shelter.lng%>);
				
				var infowindow_<%=shelter.id%> = new google.maps.InfoWindow({
					// center: myLatlng,
					position: shelterLatLng_<%=shelter.id%>, // Remove this uncomment marker if we want an icon to show up
					content: $("#shelter_details_<%=shelter.id%>").html()
				});

				var marker_<%=shelter.id%> = new google.maps.Marker({
					// center: myLatlng,
				    position: shelterLatLng_<%=shelter.id%>,
				    map: map,
				    icon: '/images/logo_small.png',
					clickable: true
				});

			    // infowindow.open(map, marker);
				google.maps.event.addListener(marker_<%=shelter.id%>, 'click', function() {
					infowindow_<%=shelter.id%>.open(map,marker_<%=shelter.id%>);
				});
<% end %>
			});
		</script>
		
		
		<div id="map_canvas" style="width:90%; height: 600px;"></div>
		
		<% @shelters.each do |shelter| %>
			<div id="shelter_details_<%=shelter.id%>" style="display:none;">
				<ul>
					<li><h2><%=shelter.name%></h2></li>
					<li><%=shelter.street%></li>
					<li><%=shelter.city%>, <%=shelter.state%> <%=shelter.zip_code%><br /><br /></li>
				</ul>
			</div>
		<% end %>
		

	</div>
		
<% end %>

<%= content_for :sidebar do %>
<% end %>