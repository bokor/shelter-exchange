<%= title "#{@shelter.name}" %>

<%= content_for :javascripts do %>
<%= javascript_include_tag "admin/shelters", "admin/accounts", "http://maps.google.com/maps/api/js?sensor=false", :cache => "cache/admin/shelters-index" %>
	<script type="text/javascript">
		$(function() {
			Shelters.loadMap(<%=@shelter.lat%>, <%=@shelter.lng%>);
		});
	</script>
<% end %>

<%= content_for :page_content do %>

	<div class="page_heading blue">
		<h1><%= @shelter.name %></h1>
		<% if @shelter.logo.file? %>
			<div class="logo">
				<%= image_tag @shelter.logo.url(:thumb)%>
			</div>
		<% end %>
	</div>
	
	<div class="page_content">
		
		<div class="shelter_details">
			<div id="address">
				<h3>Address:</h3>
				<ul>
					<li><%= @shelter.name %></li>
					<li><%= @shelter.street %></li>
					<% unless @shelter.street_2.blank? %>
						<li><%= @shelter.street_2 %></li>
					<% end %>
					<li><%= @shelter.city %>, <%= @shelter.state %> <%= @shelter.zip_code %></li>
				</ul>
				<% if @shelter.is_kill_shelter %>
					<div class="shelter_type kill">Kill Shelter</div>
				<% else %>
					<div class="shelter_type no_kill">No Kill Shelter</div>
				<% end %>
			</div>
			<div id="contact_details">
				<h3>Contact Details:</h3>
				<ul>
					<li>Phone:  <%= number_to_phone(@shelter.phone, :delimiter => "-") %></li>
				
					<% unless @shelter.fax.blank? %>
						<li>Fax:  <%= number_to_phone(@shelter.fax, :delimiter => "-") %></li>
					<% end %>
					
					<li>Email:  <%= @shelter.email %></li>
				</ul>
				
				<h3>Website Details:</h3>
				<ul>
					<% unless @shelter.website.blank? %>
						<li>Website:  <a href="<%= @shelter.website %>" target="_blank"><%= @shelter.website %></a></li>
					<% end %>

					<% unless @shelter.twitter.blank? %>
						<li>Twitter:  <a href="<%= @shelter.twitter %>" target="_blank"><%= @shelter.twitter %></a></li>
					<% end %>

					<% unless @shelter.facebook.blank? %>
						<li>Facebook Page:  <a href="<%= @shelter.facebook %>" target="_blank"><%= @shelter.facebook %></a></li>
					<% end %>
				</ul>
			</div>
		</div>
		
		
		<div class="stats">
			<h2>Counts by status</h2>
			<div class="counts_by_status_list">
				<% @counts_by_status.map do |status, count| %>
					<div class="counts_by_status">
						<span class="status"><%= status %></span>
						<span class="count"><%= count %></span>
					</div>
				<% end %>
			</div>
		</div>
		
		<div class="stats">
			<h2>Shelter Users</h2>
			<div class="user_list">
				<% @users.each do |user| %>
					<div id="<%= "user_#{user.id}" %>" class="user">
						<span class="name"><%= user.name %></span>
						<span class="role"><%= user.role.humanize %></span>
						<span class="email"><%= user.email %></span>
					</div>
				<% end %>
			</div>
		</div>
		
		<div class="stats">
			<% unless @capacities.blank? %>
				<h2>Does this shelter have room?</h2>
				<table class="capacity_details">
					<thead>
						<tr>
							<th>Animal</th>
							<th>Status</th>
							<th>Space Avail</th>
							<th>Max</th>
						</tr>
					</thead>
					<tbody>
					<% @capacities.each do |capacity| %>
						<% animal_count = capacity.animal_type.animals.active.count %>
						<%  status_class = ""
							if animal_count >= capacity.warning_level and animal_count <= capacity.max_capacity
								status_class = "warning_level"  
							elsif animal_count >= capacity.max_capacity
								status_class = "over_capacity"
							else 
								status_class = "normal"
							end
						%>
						<tr class="row">
							<td><%= capacity.animal_type.name %></td>
							<td class="<%=status_class%>"><div class="circle"></div></td>
							<td><%= capacity.max_capacity - animal_count %></td>
							<td><%= capacity.max_capacity%></td>
						</tr>
					<% end %>
					</tbody>
				</table>
				<table class="legend">
					<tr>
						<td class="over_capacity"><div class="circle"><span>Full</span></div></td>
						<td class="warning_level"><div class="circle"><span>Almost full</span></div></td>
						<td class="normal"><div class="circle"><span>Good</span></div></td>
					</tr>
				</table>
			<% end %>
		</div>
		
	</div>
		
<% end %>

<%= content_for :sidebar do %>

	<%= render @account %>
	
	<div id="map_canvas"></div>
	
<% end %>

