$("#<%= form_id %> li").removeClass("error");
$("#<%= form_id %> p.error").replaceWith("");

<% target.errors.each do |field, msg| %>
  var elementId = "#<%= form_id %> #<%= target.class.model_name.downcase %>_<%= field %>";
  // If the field doesn't exist with the model name prepended then try without.
  // Example: animal_primary_breed or primary_breed
  if($(elementId).length < 1) {
    elementId = "#<%= form_id %> #<%= field %>";
  }

  // Hack to fix nested forms but still not 100% correct
  elementId = elementId.replace(".","_attributes_0_")

	var element = $(elementId).parent().closest('li');
	element.addClass('error');
	element.append("<%= escape_javascript(create_error_message(msg)) %>");
<% end %>

// Custom Form Errors are extra errors not nesessarily tied with a field.  They can be added to a <li class="custom_form_error">
if ($(".custom_form_errors p.error").length) {
	$(".custom_form_errors").show();
}
