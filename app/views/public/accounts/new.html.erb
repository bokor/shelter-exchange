<%= title "Create a new account" %>
<%= description "Shelters and rescue groups can create an account to utilize the free service from Shelter Exchange." %>
<%= keywords "Shelter Exchange, animal shelters, animal rescue groups, animal rescue, homeless animals, create a new account, animal euthanasia, shelter exchange, animal welfare community, euthanized, euthanized animals, find animals, search shelters, local shelters, adoptive parents, animals by euthanasia date, saving lives, age-oriented, breed-specific, special needs animals, shelter management software, shelter management application" %>

<%= content_for :javascripts do %>
	<script type="text/javascript" charset="utf-8">
		$(function() {
			/* Signup - Subdomain Autofill
			/*----------------------------------------------------------------------------*/
      var formatSubdomain = function(value) {
        return value.replace(/[^a-zA-Z0-9-]+/g, '').toLowerCase().substr(0,50);
      }

			$("#account_shelters_attributes_0_name").keyup(function(e) {
				var subdomain = formatSubdomain($(this).val());
				$("#account_subdomain").val(subdomain);
        $(".subdomain_highlight").text(subdomain);
      });

      $("#account_subdomain").keyup(function(e) {
        // store current positions in variables
        var start = this.selectionStart;
        var end = this.selectionEnd;

        // Update Text
        var subdomain = formatSubdomain($(this).val());
				$(".subdomain_highlight").text(subdomain);
        $(this).val(subdomain);

        // restore from variables...
        this.setSelectionRange(start, end);
			});

			if ($("#account_subdomain").val() != "") {
				$(".subdomain_highlight").text($("#account_subdomain").val());
      }

      $("#account_form").on("submit",function(event){
        subdomain = $("#account_subdomain").val();
        $("#account_subdomain").val(subdomain.replace(/(^\W+)|(\W+$)/g, ""));
      });
		});
	</script>
<% end %>

<%= content_for :page_content do %>

	<ul class="submenu">
		<li><a class="<%=sub_navigation(:shelters_and_rescues)%>" href="/shelters_and_rescues">Shelters and Rescues</a></li>
		<li><a class="<%=sub_navigation(:signup)%>" href="/signup">Sign Up</a></li>
		<li><a class="<%=sub_navigation(:login)%>" href="/login">Login</a></li>
	</ul>

	<h1>Create a new account</h1>

	<%= render "shared/error_messages", :target => @account %>

  <%= form_for (@account), :url => public_signup_path, :html => { :multipart => true, :id => "account_form" } do |account_form| %>

		<%= account_form.fields_for :shelters do |shelter_fields| %>
		<ul>
			<li class="section">
				<section>
					<h3>Step 1:  Organization details</h3>
					<div>Please provide details below for your animal welfare organization</div>
				</section>
			</li>
			<li id="shelter_name_container" class="full">
				<%= shelter_fields.label :name, "Organization Name <span class='req'>*</span>".html_safe, :class => "desc" %>
				<div><%= shelter_fields.text_field :name, :class => "field text medium" %></div>
				<%= has_error_message?(@account.shelters.first, :name)%>
			</li>
			<li id="shelter_address_container" class="full complex">
				<%= shelter_fields.label :address, "Address <span class='req'>*</span>".html_safe, :class => "desc" %>
				<div>
					<span class="full addr1">
						<%= shelter_fields.text_field :street, :class => "field text addr", :maxlength => 255 %>
						<%= shelter_fields.label :street, "Street Address" %>
					</span>
					<span class="full addr2">
						<%= shelter_fields.text_field :street_2, :class => "field text addr", :maxlength => 255 %>
						<%= shelter_fields.label :street_2, "Address Line 2" %>
					</span>
					<span class="left">
						<%= shelter_fields.text_field :city, :class => "field text addr", :maxlength => 255 %>
						<%= shelter_fields.label :city, "City" %>
					</span>
					<span class="right">
						<%= shelter_fields.select :state, US_STATES.map {|k,v| [ v, k ] }, { :prompt => "Select State" }, { :class => "field select addr" }  %>
						<%= shelter_fields.label :state, "State" %>
					</span>
					<span class="clear left">
						<%= shelter_fields.text_field :zip_code, :class => "field text addr", :maxlength => 255 %>
						<%= shelter_fields.label :zip_code, "Zip Code" %>
					</span>
				</div>
				<%= has_error_message?(@account.shelters.first, :address)%>
			</li>
			<li id="shelter_phone_container" class="full">
				<%= shelter_fields.label :phone, "Main phone <span class='req'>*</span>".html_safe, :class => "desc" %>
				<div>
					<%= shelter_fields.text_field :phone, :class => "field text medium", :maxlength => 12  %>
					<%= shelter_fields.label :phone, "###-###-####" %>
				</div>
				<%= has_error_message?(@account.shelters.first, :phone)%>
			</li>
			<li id="shelter_email_container" class="full">
				<%= shelter_fields.label :email, "Email <span class='req'>*</span>".html_safe, :class => "desc" %>
				<div><%= shelter_fields.text_field :email, :class => "field text medium", :type => "email", :maxlength => 255 %></div>
				<%= has_error_message?(@account.shelters.first, :email)%>
			</li>
			<li id="shelter_is_kill_container">
				<%= shelter_fields.label :is_kill_shelter, "Are you a kill shelter? <span class='req'>*</span>".html_safe, :class => "desc" %>
				<div>
					<span>
					<%= shelter_fields.radio_button :is_kill_shelter, true, :class => "field radio" %>
					<%= shelter_fields.label :is_kill_shelter, "Yes", :class => "choice" %>
					</span>
					<span>
					<%= shelter_fields.radio_button :is_kill_shelter, false, :class => "field radio" %>
					<%= shelter_fields.label :is_kill_shelter, "No", :class => "choice" %>
					</span>
				</div>
				<%= has_error_message?(@account.shelters.first, :is_kill_shelter)%>
			</li>
			<li id="shelter_timezone_container">
				<%= shelter_fields.label :time_zone, "Time Zone <span class='req'>*</span>".html_safe, :class => "desc" %>
				<div>
          <%= shelter_fields.collection_select :time_zone, ActiveSupport::TimeZone.us_zones, :name, :name, {:prompt => "Select Timezone"}, {:class => "field select medium"} %>
				</div>
				<%= has_error_message?(@account.shelters.first, :time_zone)%>
			</li>
			<li><p></p></li>

			<li class="section">
				<section>
					<h3>Step 2:  Organization Status</h3>
					<div>Please provide one of the following documents to verify the status of your organization:</div>
				</section>
			</li>
			<% end %>
			<li id="account_document_type_container">
				<%= account_form.label :document_type, "Document type", :class => "desc" %>
				<div>
          <span>
            <%= account_form.radio_button :document_type, "501(c)(3) determination letter", :class => "field radio" %>
            <%= account_form.label :document_type_501c3_determination_letter, "501(c)(3) determination letter", :class => "choice" %>
          </span>
          <span>
            <%= account_form.radio_button :document_type, "990 tax form", :class => "field radio" %>
            <%= account_form.label :document_type_990_tax_form, "990 tax form", :class => "choice" %>
           <span>
            <%= account_form.radio_button :document_type, "Your adoption contract", :class => "field radio" %>
            <%= account_form.label :document_type_your_adoption_contract, "Your adoption contract", :class => "choice" %>
          </span>
				</div>
				<%= has_error_message?(@account, :document_type)%>
			</li>
			<li id="account_document_container" class="full">
				<%= account_form.label :document, (@account.document? ? "Document has been attached" : "Upload document"), :class => "desc" %>
				<% unless @account.document? %>
				<div>
					<%= account_form.file_field :document, :class => "field file" %>
				</div>
				<% end %>
				<%= account_form.hidden_field :document_cache, :class => "field file" %>
				<%= has_error_message?(@account, :document)%>
			</li>

			<li><p></p></li>

			<%= account_form.fields_for :users do |user_fields| %>
				<li class="section">
					<section>
						<h3>Step 3:  Account owners details</h3>
						<div>Please provide the details for the main contact who will manage this account</div>
					</section>
				</li>
				<li id="user_name_container" class="full">
					<%= user_fields.label :name, "First and Last name <span class='req'>*</span>".html_safe, :class => "desc" %>
					<div><%= user_fields.text_field :name, :class => "field text medium" %></div>
					<%= has_error_message?(@account.users.first, :name)%>
				</li>
				<li id="user_email_container" class="full">
					<%= user_fields.label :email, "Email <span class='req'>*</span>".html_safe, :class => "desc" %>
					<div><%= user_fields.text_field :email, :class => "field text medium" %></div>
					<%= has_error_message?(@account.users.first, :email)%>
				</li>
				<li id="user_password_container" class="full">
					<%= user_fields.label :password, "Password <span class='req'>*</span>".html_safe, :class => "desc" %>
					<div><%= user_fields.password_field :password, :class => "field text medium" %></div>
					<%= has_error_message?(@account.users.first, :password)%>
				</li>
				<li id="user_password_confirmation_container" class="full">
					<%= user_fields.label :password_confirmation, "Confirm Password <span class='req'>*</span>".html_safe, :class => "desc" %>
					<div><%= user_fields.password_field :password_confirmation, :class => "field text medium" %></div>
					<%= has_error_message?(@account.users.first, :password_confirmation)%>
				</li>
			<% end %>

			<li><p></p></li>

			<li class="section">
				<section>
					<h3>Step 4: Organization URL</h3>
          <div>Below is a personalized subdomain for your organization. You are welcome to edit if you want a different name. Please note: You can only use lowercase letters, numbers and dashes, but NO characters like # or %.</div>
				</section>
			</li>
			<li id="account_subdomain_container" class="full">
				<%= account_form.label :subdomain, "Subdomain <span class='req'>*</span>".html_safe, :class => "desc" %>
		  		<div>
					<span>
						<%= account_form.text_field :subdomain, :class => "field text medium" %>.shelterexchange.org
						<%= account_form.label :subdomain, 'Your URL: http://<span class="subdomain_highlight">johnsrescuedogs</span>.shelterexchange.org'.html_safe, :class => "subdomain_example" %>
					</span>
				</div>
				<%= has_error_message?(@account, :subdomain)%>
			</li>

			<li class="buttons">
				<br />
				<p>By clicking the create new account button, you agree to the <a href="/terms_of_service?layout=popup" class="popup_fancybox" target="_blank">Terms of service</a> and <a href="/privacy?layout=popup" class="popup_fancybox" target="_blank">Privacy policy</a>.</p>
				<div>
					<%= account_form.submit "Create new account", :disable_with => 'Submiting...', :class => 'button' %>
				</div>
			</li>
		</ul>
	<% end %>


<% end %>

<%= content_for :sidebar do %><% end %>
