<%= title "Save a life" %>
<%= description "" %>
<%= keywords "" %>

<%= content_for :javascripts do %>
	<%= javascript_include_tag "http://maps.google.com/maps/api/js?sensor=false" %>
	<script type="text/javascript">
		$(function() {
			
			SaveALife.initialize(38.6,-98,"<%=s3_url('maps/overlay.kmz')%>","<%=s3_url('images/logo_small.png')%>");
			// // SaveALife.initialize(38.6,-98,"<%=s3_url('maps/overlay.kmz')%>","<%=s3_url('images/logo_small.png')%>");
			// 			
			// 			if (navigator.geolocation) {
			// 				navigator.geolocation.getCurrentPosition(loadMap);
			// 			} else {
			// 				SaveALife.initialize(38.6,-98,"<%=s3_url('maps/overlay.kmz')%>","<%=s3_url('images/logo_small.png')%>", 4);
			// 			}
			// 			
			// 			function loadMap(position){  
			// 				var lat = position.coords.latitude;
			// 				var lng = position.coords.longitude;
			// 				// if (lat == null && lng == null){
			// 					SaveALife.initialize(38.6,-98,"<%=s3_url('maps/overlay.kmz')%>","<%=s3_url('images/logo_small.png')%>", 4);
			// 				// } else {
			// 					// SaveALife.initialize(lat,lng,"<%=s3_url('maps/overlay.kmz')%>","<%=s3_url('images/logo_small.png')%>");
			// 				// }
			// 			}
			// 		
			// 			
			// 			function getPostalCode(latitude, longitude) {
			// 				var geocoder, latlng, streetValue, strippedVal, postalCodeValue, pcPattern = /[0-9]{5},/;
			// 				geocoder = new google.maps.Geocoder();
			// 				latlng = new google.maps.LatLng(latitude, longitude);
			// 				geocoder.geocode({'latLng': latlng}, function(results, status) {
			// 					if (status == google.maps.GeocoderStatus.OK) {
			// 						if (results[0]) {
			// 							streetValue = results[0].formatted_address;
			// 							// match results against pcPatter regex *included , at end of zip to ensure correct data
			// 							strippedVal = new String(streetValue.match(pcPattern));
			// 							// strip the comma, pass the postal code to geoSetPostalCode
			// 							postalCodeValue = strippedVal.replace(',','');
			// 							log('SUCCESS---->\nLocationController.getPostalCode:\nPostal Code: ' + postalCodeValue);
			// 							alert(postalCodeValue);
			// 						}
			// 					} else {
			// 						// if status is anything other than OK, log and do fallback
			// 						log('ERROR---->\nLocationController.getPostalCode:\nStatus: ' + status);
			// 						LocationController.geoSetFallbackValue();
			// 					}
			// 				});
			// 			}
		});
	</script>
<% end %>

<%= content_for :page_content do %>


	<div class="page_content">
			
		<div class="search_content">
			<span class="search_form">
				<form action="#" id="form_city_zipcode_search">
			    	<%= text_field_tag :city_zipcode, "" %> <!-- #{city_zipcode_default} -->
				</form>
				<form action="#" id="form_shelter_name_search">
			    	<%= text_field_tag :shelter_name, "" %>
				</form>
				<ul class="toggle_buttons">
					<li><a id="search_by_city_zipcode" href="#">City or Zip code</a></li>
					<li><a id="search_by_shelter_name" href="#">Shelter Name</a></li>
				</ul>
			</span>
			<span class="narrow_search">
				<ul class="toggle_buttons">
					<li><a id="narrow_search_results" href="#">Narrow your search results?</a></li>
				</ul>
			</span>

		</div>
	</div>
		
	<div class="map_separator"></div>
		
	<div id="filters" class="section_heading no_borders blue">
		<%= render "form_filters" %>
	</div>
	
	<div class="page_content">	
			
		<table id="results_by_city_zipcode" class="results">
			<tr>
				<td class="shelter_half">
					<div id="map_canvas"></div>
				</td>
				<td class="animal_half">
					<div id="map_animals" class="animals">
						<h1>Animal List Loading</h1>
					</div>
				</td>
			</tr>
		</table>
			
		<table id="results_by_shelter_name" class="results">
			<tr>
				<td class="shelter_half">
					<div id="shelter_details">
						<h1>Shelter Details</h1>
					</div>
				</td>
				<td class="animal_half">
					<div id="shelter_animals" class="animals">
						<h1>Animal List</h1>
					</div>
				</td>
			</tr>
		</table>
	</div>
		
<% end %>

<%= content_for :sidebar do %>
<% end %>